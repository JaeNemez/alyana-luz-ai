
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title>Alyana Luz ¬∑ Bible AI</title>

    <style>
      * { box-sizing: border-box; }

      :root{
        --bg-0: #050316;
        --bg-1: #090424;

        --surface-0: rgba(12, 10, 29, 0.82);
        --surface-1: rgba(14, 12, 36, 0.74);
        --surface-2: rgba(18, 16, 48, 0.62);

        --border-0: rgba(255,255,255,0.12);
        --border-1: rgba(186,108,184,0.22);
        --border-2: rgba(186,108,184,0.30);

        --text-0: #f9f5ff;
        --text-1: rgba(249,245,255,0.88);
        --text-2: rgba(249,245,255,0.74);

        --accent: #9A4B9C;
        --accent-2: #A95CA9;
        --accent-3: #BA6CB8;

        --accent-dark: #2a1030;
        --accent-soft: rgba(154,75,156,0.22);

        --good: #22c55e;
        --danger: #e11d48;
        --ghost: rgba(255,255,255,0.10);

        --focus: rgba(186,108,184,0.55);
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
        background: var(--bg-0);
        color: var(--text-0);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .app {
        width: 100%;
        max-width: 1000px;
        height: 92vh;
        display: flex;
        flex-direction: column;

        background:
          radial-gradient(circle at 28% 8%, rgba(186,108,184,0.55) 0, rgba(154,75,156,0.22) 22%, rgba(5,3,22,1) 60%),
          radial-gradient(circle at 80% 18%, rgba(169,92,169,0.22) 0, rgba(5,3,22,1) 55%);

        border-radius: 18px;
        border: 1px solid var(--border-0);
        box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        overflow: hidden;
      }

      header {
        padding: 16px 24px 10px;
        border-bottom: 1px solid rgba(255,255,255,0.08);
        display: flex;
        flex-direction: column;
        gap: 4px;
        position: relative;
      }
      header h1 { margin: 0; font-size: 20px; display: flex; align-items: center; gap: 8px; }
      header h1 span.emoji { font-size: 22px; }
      header small { color: rgba(249,245,255,0.72); font-size: 12px; }

      .js-pill {
        position: absolute;
        right: 16px;
        top: 14px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(186,108,184,0.22);
        font-size: 12px;
        font-weight: 800;
        white-space: nowrap;
        color: var(--text-1);
      }

      /* -----------------------------
         TOP AREA (Support / Account)
         ----------------------------- */

      .top-cta {
        padding: 10px 24px 14px;
        border-bottom: 1px solid rgba(255,255,255,0.08);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .support-btn {
        padding: 10px 16px;
        background: linear-gradient(135deg, var(--accent-2), var(--accent));
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 10px;
        font-size: 14px;
        font-weight: 800;
        cursor: pointer;
        color: #ffffff;
        box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      }
      .support-btn:active { transform: translateY(1px); }

      .support-note {
        font-size: 11px;
        opacity: 0.85;
        max-width: 760px;
        text-align: center;
        margin: 0;
        color: var(--text-2);
        white-space: pre-line;
      }

      .account-row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(186,108,184,0.22);
        font-size: 12px;
        font-weight: 800;
        white-space: nowrap;
        color: var(--text-1);
      }

      .pill.ok { border-color: rgba(34,197,94,0.55); }
      .pill.warn { border-color: rgba(186,108,184,0.45); }
      .pill.bad { border-color: rgba(225,29,72,0.65); }

      .muted { opacity: 0.85; font-size: 13px; color: var(--text-2); }

      .row { display: flex; gap: 10px; flex-wrap: wrap; }
      .row > * { flex: 1; min-width: 220px; }

      label { font-size: 12px; opacity: 0.9; color: var(--text-2); }

      input[type="text"], select, textarea {
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(186,108,184,0.35);
        background: rgba(10, 8, 28, 0.72);
        color: var(--text-0);
        outline: none;
        font-size: 14px;
      }
      input[type="text"]:focus, select:focus, textarea:focus{
        border-color: var(--focus);
        box-shadow: 0 0 0 3px rgba(186,108,184,0.16);
      }

      textarea { min-height: 110px; resize: vertical; }

      .btn {
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid rgba(186,108,184,0.18);
        cursor: pointer;
        font-weight: 900;
        font-size: 13px;
        color: #ffffff;
        background: rgba(255,255,255,0.08);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent-2), var(--accent));
        border: 1px solid rgba(255,255,255,0.14);
        color: #ffffff;
      }
      .btn-primary:hover { filter: brightness(1.03); }

      .btn-danger { background: rgba(225,29,72,0.92); border-color: rgba(225,29,72,0.35); color: white; }
      .btn-green { background: rgba(34,197,94,0.92); border-color: rgba(34,197,94,0.30); color: #062a14; }
      .btn-ghost { background: rgba(255,255,255,0.07); color: white; border-color: rgba(186,108,184,0.18); }
      .btn:disabled { opacity: 0.6; cursor: default; }

      /* Collapsible restore panel */
      .restore-wrap{
        width: 100%;
        max-width: 820px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
      }

      .restore-toggle{
        display: none; /* shown on mobile only */
        width: 100%;
        max-width: 520px;
        justify-content: center;
        gap: 10px;
        align-items: center;
      }

      .restore-panel{
        width: 100%;
        max-width: 760px;
        display: block;
      }

      .restore-panel.collapsed{
        display: none;
      }

      /* Hide restore content when subscribed */
      .member-hide{
        display: block;
      }
      .is-member .member-hide{
        display: none !important;
      }

      /* -----------------------------
         NAV + MAIN
         ----------------------------- */

      .menu-bar {
        padding: 12px 18px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        border-bottom: 1px solid rgba(255,255,255,0.08);
      }

      .menu-btn {
        padding: 8px 12px;
        border-radius: 999px;
        border: 1px solid rgba(186,108,184,0.16);
        font-size: 13px;
        font-weight: 800;
        cursor: pointer;
        background: rgba(255,255,255,0.07);
        color: var(--text-0);
        box-shadow: 0 1px 3px rgba(0,0,0,0.25);
      }
      .menu-btn.active {
        background: linear-gradient(135deg, var(--accent-2), var(--accent));
        border: 1px solid rgba(255,255,255,0.14);
        color: #ffffff;
      }

      .main { flex: 1; overflow: hidden; display: flex; flex-direction: column; min-height: 0; }
      .app-section { display: none; height: 100%; overflow: hidden; min-height: 0; }
      .app-section.active { display: flex; flex-direction: column; height: 100%; min-height: 0; }

      .section-body {
        flex: 1;
        overflow-y: auto;
        padding: 18px;
        min-height: 0;
        -webkit-overflow-scrolling: touch;
      }

      .card {
        background: var(--surface-1);
        border: 1px solid var(--border-1);
        border-radius: 16px;
        padding: 14px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      }
      .card + .card { margin-top: 12px; }
      .card h3, .card h4 { margin: 0 0 10px 0; color: rgba(255,255,255,0.92); }

      .saved-list button { width: 100%; text-align: left; margin-top: 8px; }

      .divider {
        height: 1px;
        background: rgba(186,108,184,0.18);
        margin: 12px 0;
      }

      /* ===========================
         CHAT (MOBILE INPUT VISIBILITY)
         =========================== */

      .chat-layout{
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 12px;
        min-height: 0;
      }

      @media (max-width: 920px){
        .chat-layout{
          display: flex;
          flex-direction: column;
          gap: 12px;
          min-height: 0;
        }
      }

      #chatCard{
        display: flex;
        flex-direction: column;
        min-height: 0;
        overflow: hidden;
      }

      #chat{
        flex: 1;
        min-height: 260px;
        overflow-y: auto;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        border-radius: 16px;
        border: 1px solid rgba(186,108,184,0.22);
        background: rgba(10, 8, 28, 0.45);
        -webkit-overflow-scrolling: touch;
      }

      .bubble-row { display: flex; width: 100%; }
      .bubble-row.user { justify-content: flex-end; }
      .bubble-row.bot { justify-content: flex-start; }
      .bubble-row.system { justify-content: center; }

      .bubble {
        max-width: 84%;
        padding: 10px 14px;
        border-radius: 16px;
        font-size: 14px;
        line-height: 1.5;
        white-space: pre-wrap;
      }
      .bubble.user {
        background: linear-gradient(135deg, var(--accent-2), var(--accent));
        color: #ffffff;
        border-bottom-right-radius: 6px;
        border: 1px solid rgba(255,255,255,0.14);
      }
      .bubble.bot {
        background: rgba(10, 8, 28, 0.84);
        color: var(--text-1);
        border: 1px solid rgba(186,108,184,0.26);
        border-bottom-left-radius: 6px;
      }
      .bubble.system {
        background: transparent;
        border: none;
        color: rgba(249,245,255,0.55);
        font-size: 12px;
        text-align: center;
      }

      .chat-form{
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 12px 12px 14px;
        border-top: 1px solid rgba(255,255,255,0.08);
        background: rgba(10, 8, 28, 0.92);
        border-radius: 16px;
      }

      .chat-form input[type="text"]{
        flex: 1 1 100%;
        min-width: 0;
        height: 48px;
        padding: 12px 16px;
        border-radius: 999px;
        font-size: 16px;
        background: rgba(10, 8, 28, 0.85);
      }

      .chat-form .btn{
        flex: 1 1 calc(50% - 5px);
        border-radius: 999px;
        padding: 12px 14px;
        font-size: 14px;
        min-height: 46px;
      }

      @media (max-width: 420px){
        .chat-form .btn{ flex: 1 1 48%; }
      }

      @media (max-width: 920px){
        .chat-form{
          position: sticky;
          bottom: 0;
          z-index: 50;
          padding-bottom: calc(14px + env(safe-area-inset-bottom, 0px));
        }
        #chatSection .chat-layout > .card:last-child{
          max-height: 36vh;
          overflow: auto;
        }
        #chat{
          min-height: 44vh;
        }
      }

      /* -----------------------------
         MOBILE: COLLAPSE TOP CTA
         ----------------------------- */
      @media (max-width: 900px) {
        body {
          align-items: stretch;
          justify-content: flex-start;
          min-height: 100dvh;
        }
        .app {
          height: 100dvh;
          max-height: 100dvh;
          max-width: 100%;
          border-radius: 0;
        }
        .section-body { padding: 12px; }

        /* Make top area tighter */
        header{ padding: 14px 16px 8px; }
        .top-cta{ padding: 10px 16px 12px; gap: 10px; }

        /* Show compact toggle row and collapse restore by default */
        .restore-toggle{
          display: flex;
        }
        .restore-panel{
          max-width: 100%;
        }
        /* When not expanded, keep restore collapsed */
        .restore-panel.collapsed{
          display: none;
        }

        /* Reduce support button width on mobile */
        .support-btn{
          width: 100%;
          max-width: 520px;
        }

        /* Account row more compact */
        .account-row{
          width: 100%;
          max-width: 820px;
        }

        /* Reduce note visual footprint (only for non-members) */
        .support-note{
          max-width: 720px;
          line-height: 1.35;
        }
      }
    </style>
  </head>

  <body>
    <div class="app" id="appRoot">
      <header>
        <h1><span class="emoji">üìñ</span> Alyana Luz ¬∑ Bible AI</h1>
        <small id="tagline">pray ‚Ä¢ learn ‚Ä¢ walk in the Light</small>
        <span class="js-pill" id="jsStatus">JS: loading‚Ä¶</span>
      </header>

      <div class="top-cta" id="topCta">
        <button class="support-btn" id="supportBtn" type="button">
          ‚ù§Ô∏è <span id="supportBtnText">Support Alyana Luz</span>
        </button>

        <div class="account-row" aria-label="Account and billing">
          <span class="pill warn" id="authPill">Account: checking‚Ä¶</span>

          <button class="btn btn-ghost" id="manageBillingBtn" type="button" disabled>
            <span id="manageBillingText">Manage billing</span>
          </button>

          <button class="btn btn-danger" id="logoutBtn" type="button" style="display:none;">
            <span id="logoutText">Logout</span>
          </button>

          <label style="min-width:170px;">
            <span class="muted" id="uiLangLabel" style="display:block; margin-bottom:4px;">Language</span>
            <select id="uiLangSelect">
              <option value="en">English</option>
              <option value="es">Espa√±ol</option>
            </select>
          </label>
        </div>

        <!-- Everything in here is hidden for members -->
        <div class="restore-wrap member-hide" id="restoreWrap">
          <!-- Mobile toggle -->
          <div class="restore-toggle">
            <button class="btn btn-ghost" id="restoreToggleBtn" type="button" style="width:100%; max-width:520px;">
              <span id="restoreToggleText">Restore access</span>
            </button>
          </div>

          <!-- Collapsible panel -->
          <div class="restore-panel collapsed" id="restorePanel">
            <p class="support-note" id="supportNote">
              Your support helps maintain and grow Alyana Luz ‚Äî continually improving development and expanding this ministry.
              <br />
              To access premium features, subscribe with Support, or restore access using the email you used on Stripe.
            </p>

            <div class="row" style="max-width:760px; width:100%; justify-content:center;">
              <div style="flex:1; min-width:240px; max-width:360px;">
                <input id="loginEmail" type="text" placeholder="Email used for Stripe‚Ä¶" />
              </div>
              <div style="flex:0; min-width:180px;">
                <button class="btn btn-primary" id="loginBtn" type="button" style="width:100%;">
                  <span id="restoreBtnText">Restore access</span>
                </button>
              </div>
            </div>

            <div class="muted" id="authHint" style="width:100%; text-align:center; display:none;"></div>
          </div>
        </div>
      </div>

      <nav class="menu-bar">
        <button class="menu-btn active" data-target="chatSection" type="button" id="tabChat">Chat</button>
        <button class="menu-btn" data-target="bibleSection" type="button" id="tabBible">Read Bible</button>
        <button class="menu-btn" data-target="devotionalSection" type="button" id="tabDev">Devotional</button>
        <button class="menu-btn" data-target="prayerSection" type="button" id="tabPrayer">Daily Prayer</button>
      </nav>

      <div class="main">
        <!-- CHAT -->
        <section id="chatSection" class="app-section active">
          <div class="section-body">
            <div class="chat-layout">
              <div class="card" id="chatCard">
                <div class="row" style="align-items:center; margin-bottom:10px;">
                  <div style="flex:2;">
                    <h3 style="margin:0 0 4px 0;" id="chatTitle">Chat</h3>
                    <div class="muted" id="chatSub">Saved chat logs are stored on this device.</div>
                  </div>

                  <div style="display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap; align-items:center;">
                    <label style="min-width:170px;">
                      <span class="muted" id="chatLangLabel" style="display:block; margin-bottom:4px;">Chat Language</span>
                      <select id="chatLangSelect">
                        <option value="auto" selected>Auto (based on what they type)</option>
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                      </select>
                    </label>
                    <span class="pill" id="chatVoicePill">Voice: ready</span>
                  </div>
                </div>

                <div id="chat"></div>

                <form id="chatForm" class="chat-form">
                  <input
                    id="chatInput"
                    type="text"
                    autocomplete="off"
                    placeholder="Ask for a prayer, verse, or ‚Äòverses about forgiveness‚Äô‚Ä¶"
                  />
                  <button class="btn btn-primary" type="submit" id="chatSendBtn">Send</button>
                  <button class="btn btn-ghost" type="button" id="chatListenBtn">Listen</button>
                  <button class="btn btn-danger" type="button" id="chatStopBtn">Stop</button>
                  <button class="btn btn-ghost" type="button" id="chatNewBtn">New</button>
                  <button class="btn btn-green" type="button" id="chatSaveBtn">Save</button>
                </form>
              </div>

              <div class="card" style="overflow:auto;">
                <h4 style="margin-bottom:6px;" id="savedChatsTitle">Saved Chats</h4>
                <div class="muted" id="savedChatsSub">Load or delete any saved chat.</div>
                <div class="saved-list" id="chatSavedList" style="margin-top:10px;">
                  <small style="opacity:0.75;" id="noSavedChats">No saved chats yet.</small>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- BIBLE / DEVOTIONAL / PRAYER sections unchanged in this file -->
        <section id="bibleSection" class="app-section"><div class="section-body"><div class="card"><h3>Read Bible</h3><div class="muted">Bible section loads from app.js</div></div></div></section>
        <section id="devotionalSection" class="app-section"><div class="section-body"><div class="card"><h3>Devotional</h3><div class="muted">Devotional section loads from app.js</div></div></div></section>
        <section id="prayerSection" class="app-section"><div class="section-body"><div class="card"><h3>Daily Prayer</h3><div class="muted">Prayer section loads from app.js</div></div></div></section>
      </div>
    </div>

    <!-- cache bust -->
    <script src="/app.js?v=8" defer></script>

    <script>
      (function () {
        const $ = (id) => document.getElementById(id);

        // --- Restore panel toggle (mobile) ---
        function setupRestoreToggle() {
          const btn = $("restoreToggleBtn");
          const panel = $("restorePanel");
          if (!btn || !panel) return;

          // collapsed by default
          panel.classList.add("collapsed");

          btn.addEventListener("click", () => {
            panel.classList.toggle("collapsed");
          });
        }

        // --- Member UI: hide restore area if subscribed ---
        async function applyMemberUI() {
          const root = $("appRoot");
          if (!root) return;

          try {
            const r = await fetch("/me", { credentials: "include" });
            const data = await r.json();
            const isMember = !!(data && data.subscribed);

            // If member, hide restore + note by CSS
            if (isMember) root.classList.add("is-member");
            else root.classList.remove("is-member");

            // If not member, keep restore collapsed initially
            const panel = $("restorePanel");
            if (!isMember && panel) panel.classList.add("collapsed");
          } catch (e) {
            // If /me fails, do nothing (default shows restore collapsed)
          }
        }

        document.addEventListener("DOMContentLoaded", () => {
          setupRestoreToggle();
          applyMemberUI();

          // Re-check after app.js potentially updates auth/token
          setTimeout(applyMemberUI, 1200);
          setTimeout(applyMemberUI, 3000);
        });
      })();
    </script>
  </body>
</html>













