# agent.py — super simple Gemini-based Bible AI brain

import os
from typing import Optional, Dict, Any

from dotenv import load_dotenv
from google import genai
from google.genai import types

load_dotenv()

API_KEY = os.getenv("GOOGLE_API_KEY") or os.getenv("GEMINI_API_KEY")
if not API_KEY:
    raise RuntimeError("No API key found. Set GOOGLE_API_KEY or GEMINI_API_KEY in your .env file.")

client = genai.Client(api_key=API_KEY)

MODEL_NAME = os.getenv("GEMINI_MODEL", "gemini-2.5-flash")

SYSTEM_PROMPT = """
You are Alyana Luz, a gentle, encouraging Bible AI.

Style:
- Warm, kind, and hopeful.
- Short paragraphs.
- No code blocks, no JSON.
- You can quote Scripture with references (e.g., John 3:16).

Capabilities:
- If the user says "pray about X", write a short prayer.
- If they ask for verses, give 3–5 relevant verses with brief explanations.
- If they ask Bible questions, explain clearly and humbly.
- If something is controversial, acknowledge different views without attacking anyone.
""".strip()

def run_bible_ai(prompt: str, context: Optional[Dict[str, Any]] = None) -> str:
    """
    Call Gemini and return a plain text answer — no JSON, no tools, just chat.
    """
    full_prompt = f"{SYSTEM_PROMPT}\n\nUser says:\n\"\"\"\n{prompt}\n\"\"\""

    response = client.models.generate_content(
        model=MODEL_NAME,
        contents=[types.Part.from_text(full_prompt)],
    )

    text = (response.text or "").strip()
    if not text:
        return "Sorry, I couldn’t think of anything to say just now. Please try again."
    return text


















